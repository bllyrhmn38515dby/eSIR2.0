@startuml Sequence Diagram - Upload Dokumen

title Upload Dokumen Medis

actor "Dokter" as dokter
participant "Frontend" as web
participant "Backend API" as api
participant "File Storage" as storage
participant "Database" as db
participant "Notification" as notif

== Upload Dokumen ==
dokter -> web: Pilih file dokumen
note right: Format: PDF, JPG, PNG, DOC

web -> web: Validate file size & type
web -> web: Compress if needed

web -> api: POST /dokumen/upload
note right: Data: file, pasien_id, jenis_dokumen, deskripsi

api -> api: Validate file format
api -> api: Check file size limit
api -> api: Generate unique filename

api -> storage: Save file to storage
storage --> api: Return file path

api -> db: INSERT INTO dokumen (...)
note right: Fields: filename, path, size, type, pasien_id, uploaded_by

db --> api: Return dokumen_id

api -> notif: Send notification
notif -> web: Notify upload success

api --> web: Return success + dokumen_id
web --> dokter: Show upload success

== View Dokumen ==
dokter -> web: View dokumen list
web -> api: GET /dokumen?pasien_id={id}
api -> db: SELECT * FROM dokumen WHERE pasien_id = ?
db --> api: Return dokumen list
api --> web: Return JSON dokumen
web --> dokter: Show dokumen list

== Download Dokumen ==
dokter -> web: Click download
web -> api: GET /dokumen/{id}/download
api -> db: SELECT * FROM dokumen WHERE id = ?
db --> api: Return dokumen info

api -> storage: Get file from storage
storage --> api: Return file stream

api -> api: Log download activity
api -> db: INSERT INTO download_log (...)

api --> web: Return file stream
web --> dokter: Download file

== Delete Dokumen ==
dokter -> web: Select delete
web -> api: DELETE /dokumen/{id}
api -> db: SELECT * FROM dokumen WHERE id = ?
db --> api: Return dokumen info

api -> storage: Delete file from storage
storage --> api: Success

api -> db: DELETE FROM dokumen WHERE id = ?
db --> api: Success

api -> notif: Send deletion notification
api --> web: Return success
web --> dokter: Show deletion success

@enduml
